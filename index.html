<script>
  let selectedSpot = null;
  const penalizaciones = {};

  function createSpots(containerId, count) {
    const container = document.getElementById(containerId);
    for (let i = 1; i <= count; i++) {
      const spot = document.createElement('button');
      spot.className = 'spot';
      spot.textContent = i;
      spot.addEventListener('click', () => openModal(spot));
      container.appendChild(spot);
    }
  }

  function openModal(spot) {
    selectedSpot = spot;
    document.getElementById('modal').classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('modal').classList.add('hidden');
    document.getElementById('reservationForm').reset();
  }

  function penalizarUsuario(dni) {
    if (!penalizaciones[dni]) {
      penalizaciones[dni] = 1;
    } else {
      penalizaciones[dni]++;
    }
    console.log(`Usuario ${dni} penalizado. Penalizaciones: ${penalizaciones[dni]}`);
  }

  document.getElementById('reservationForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value;
    const apellido = document.getElementById('apellido').value;
    const dni = document.getElementById('dni').value;

    if (penalizaciones[dni] && penalizaciones[dni] >= 1) {
      alert(`No podés reservar. Tenés ${penalizaciones[dni]} penalización(es).`);
      closeModal();
      return;
    }

    if (nombre && apellido && dni) {
      selectedSpot.textContent = 'Ocupado';
      selectedSpot.disabled = true;
      selectedSpot.title = `Reservado por: ${nombre} ${apellido} (DNI: ${dni})`;
      closeModal();

      // Inicia cronómetro
      let tiempo = 60;
      const intervalo = setInterval(() => {
        tiempo--;
        if (tiempo === 0) {
          clearInterval(intervalo);
          penalizarUsuario(dni);
          alert(`Tiempo finalizado para ${nombre} ${apellido}. Penalización aplicada.`);
        }
      }, 1000);
    }
  });

  createSpots('autos', 30);
  createSpots('motos', 50);
</script>
